{"ast":null,"code":"import\"../App.css\";import{useState,useContext,useEffect}from\"react\";import{CartContext}from\"../context/cartContext\";import axios from\"axios\";// Usando axios para comunicación con el backend\nimport{useAuth}from\"../context/AuthContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CheckOut=()=>{const[loading,setLoading]=useState(false);const[orderId,setOrderId]=useState(\"\");const{cart,total,clearCart}=useContext(CartContext);const{user}=useAuth();const createOrder=async()=>{if(!user){alert(\"Debe iniciar sesión para completar la compra.\");return;}setLoading(true);try{// Construir el objeto de orden para Datastore\nconst objOrder={buyer:{uid:user.uid,email:user.email},items:cart,total:total,date:new Date().toISOString()};// Llamada a tu backend para crear la orden en Datastore\nconst response=await axios.post(\"http://localhost:3001/api/ordenes\",objOrder);setOrderId(response.data.id);// Asegúrate de que el backend devuelva el ID de la orden creada\n// Actualizar el stock de cada producto\nfor(let item of cart){await axios.post(\"http://localhost:3001/api/products/\".concat(item.id,\"/decrementStock\"),{quantity:item.quantity});}// Limpiar el carrito después de procesar la compra\nclearCart();}catch(error){console.error(\"Error al crear la orden o actualizar el stock:\",error);}finally{setLoading(false);}};useEffect(()=>{if(cart.length===0){alert(\"El carrito está vacío. Agrega productos antes de proceder.\");}},[cart]);if(loading){return/*#__PURE__*/_jsx(\"h1\",{children:\"Se est\\xE1 generando su orden...\"});}if(orderId){return/*#__PURE__*/_jsxs(\"h1\",{children:[\"El ID de su orden es: \",orderId]});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Resumen de tu compra\"}),cart.map(_ref=>{let{id,img,title,price,quantity}=_ref;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-uppercase fw-bolder\",id:\"itemName\",children:title}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Precio Unitario: $\",price]}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"img\",{width:\"80px\",src:img,alt:\"\"})}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Cantidad: \",quantity]})]},id);}),/*#__PURE__*/_jsxs(\"h4\",{children:[\"Total a pagar: $\",total]}),/*#__PURE__*/_jsx(\"button\",{onClick:createOrder,className:\"btn btn-primary\",children:\"Confirmar Compra\"})]});};export default CheckOut;","map":{"version":3,"names":["useState","useContext","useEffect","CartContext","axios","useAuth","jsx","_jsx","jsxs","_jsxs","CheckOut","loading","setLoading","orderId","setOrderId","cart","total","clearCart","user","createOrder","alert","objOrder","buyer","uid","email","items","date","Date","toISOString","response","post","data","id","item","concat","quantity","error","console","length","children","map","_ref","img","title","price","className","width","src","alt","onClick"],"sources":["C:/Users/guill/OneDrive/Documents/UADE/TP/equipo1-ecommerce/equipo1-ecommerce/src/views/CheckOut.jsx"],"sourcesContent":["import \"../App.css\";\r\nimport { useState, useContext, useEffect } from \"react\";\r\nimport { CartContext } from \"../context/cartContext\";\r\nimport axios from \"axios\"; // Usando axios para comunicación con el backend\r\nimport { useAuth } from \"../context/AuthContext\";\r\n\r\nconst CheckOut = () => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [orderId, setOrderId] = useState(\"\");\r\n  const { cart, total, clearCart } = useContext(CartContext);\r\n  const { user } = useAuth();\r\n\r\n  const createOrder = async () => {\r\n    if (!user) {\r\n      alert(\"Debe iniciar sesión para completar la compra.\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      // Construir el objeto de orden para Datastore\r\n      const objOrder = {\r\n        buyer: {\r\n          uid: user.uid,\r\n          email: user.email,\r\n        },\r\n        items: cart,\r\n        total: total,\r\n        date: new Date().toISOString(),\r\n      };\r\n\r\n      // Llamada a tu backend para crear la orden en Datastore\r\n      const response = await axios.post(\"http://localhost:3001/api/ordenes\", objOrder);\r\n      setOrderId(response.data.id); // Asegúrate de que el backend devuelva el ID de la orden creada\r\n\r\n      // Actualizar el stock de cada producto\r\n      for (let item of cart) {\r\n        await axios.post(`http://localhost:3001/api/products/${item.id}/decrementStock`, {\r\n          quantity: item.quantity\r\n        });\r\n      }\r\n\r\n      // Limpiar el carrito después de procesar la compra\r\n      clearCart();\r\n    } catch (error) {\r\n      console.error(\"Error al crear la orden o actualizar el stock:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (cart.length === 0) {\r\n      alert(\"El carrito está vacío. Agrega productos antes de proceder.\");\r\n    }\r\n  }, [cart]);\r\n\r\n  if (loading) {\r\n    return <h1>Se está generando su orden...</h1>;\r\n  }\r\n\r\n  if (orderId) {\r\n    return <h1>El ID de su orden es: {orderId}</h1>;\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <h3>Resumen de tu compra</h3>\r\n      {cart.map(({ id, img, title, price, quantity }) => (\r\n        <div key={id}>\r\n          <p className=\"text-uppercase fw-bolder\" id=\"itemName\">\r\n            {title}\r\n          </p>\r\n          <p>Precio Unitario: ${price}</p>\r\n          <p>\r\n            <img width={\"80px\"} src={img} alt=\"\" />\r\n          </p>\r\n          <p>Cantidad: {quantity}</p>\r\n        </div>\r\n      ))}\r\n      <h4>Total a pagar: ${total}</h4>\r\n      <button onClick={createOrder} className=\"btn btn-primary\">\r\n        Confirmar Compra\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CheckOut;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}